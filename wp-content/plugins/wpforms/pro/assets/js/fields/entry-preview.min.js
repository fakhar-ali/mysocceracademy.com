"use strict";var WPFormsEntryPreview=window.WPFormsEntryPreview||function(s,e,p){var o={init:function(){p(s).on("wpformsBeforePageChange",o.pageChange).on("wpformsEntryPreviewUpdated",function(e,t,r){r.find(".wpforms-iframe").each(o.updateIframe)}).on("wpformsAjaxSubmitSuccessConfirmation",function(){p(".wpforms-container > .wpforms-entry-preview .wpforms-iframe").each(o.updateIframe)}),p(e).on("load",function(){p(".wpforms-iframe").each(o.updateIframe)})},pageChange:function(e,t,r){p(e.target).hasClass("wpforms-page-next")&&(wpforms.saveTinyMCE(),o.update(t,r))},update:function(e,t){var r,n,i,o,a=t.find(".wpforms-page-"+e+" .wpforms-field-entry-preview");a.length&&(r=a.data("field-id"),n=a.find(".wpforms-entry-preview-updating-message"),i=a.find(".wpforms-entry-preview-notice"),o=a.find(".wpforms-entry-preview-wrapper"),(e=new FormData(t.get(0))).append("action","wpforms_get_entry_preview"),e.append("current_entry_preview_id",r),p.ajax({data:e,type:"post",url:wpforms_settings.ajaxurl,dataType:"json",processData:!1,contentType:!1,beforeSend:function(){a.addClass("wpforms-field-entry-preview-updating"),i.hide(),o.hide(),n.show()},success:function(e){e.data?(o.html(e.data),a.show()):a.hide()},complete:function(){a.removeClass("wpforms-field-entry-preview-updating"),n.hide(),i.show(),o.show(),p(s).trigger("wpformsEntryPreviewUpdated",[t,a])}}))},updateIframe:function(){var e=this,t=s.createElement("iframe");t.onload=function(){o.iframeStyles(t),o.iframeBody(t,e.innerHTML),o.iframeFullHeight(t),e.remove()},e.after(t)},iframeStyles:function(r){var n=r.contentWindow.document,i=n.querySelector("head"),e=n.createElement("style"),t=p("body").css("font-family");e.setAttribute("type","text/css"),e.innerHTML="body.mce-content-body {\tmargin: 0 !important;\tbackground-color: transparent !important;\tfont-family: "+t+";}*:first-child {\tmargin-top: 0}*:last-child {\tmargin-bottom: 0}pre {\twhite-space: pre !important;\toverflow-x: auto !important;}a,img {\tdisplay: inline-block;}",i.appendChild(e),wpforms_settings.entry_preview_iframe_styles&&wpforms_settings.entry_preview_iframe_styles.forEach(function(e){var t=n.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href",e),t.onload=function(){o.iframeFullHeight(r)},i.appendChild(t)})},iframeBody:function(e,t){var r=e.contentWindow.document,e=r.querySelector("body"),r=r.createElement("div");r.classList.add("wpforms-iframe-wrapper"),e.append(r),r.innerHTML=t,e.classList.add("mce-content-body"),e.querySelectorAll("a").forEach(function(e){e.setAttribute("rel","noopener"),e.hasAttribute("target")||e.setAttribute("target","_top")})},iframeFullHeight:function(e){var t;e.contentWindow&&e.contentWindow.document&&(t=e.contentWindow.document.querySelector(".wpforms-iframe-wrapper"),e.style.height=t.scrollHeight+"px")}};return o}(document,window,jQuery);WPFormsEntryPreview.init();